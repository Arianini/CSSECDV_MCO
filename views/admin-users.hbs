<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <link rel="stylesheet" href="/PageTemplate.css">
    <link rel="stylesheet" href="/admin-users.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    {{> menu}}
    
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-users-cog"></i> User Management</h1>
            <button class="btn btn-primary" onclick="showCreateManagerModal()">
                <i class="fas fa-user-plus"></i> Create Manager Account
            </button>
        </div>

        <!-- Users Table -->
        <div class="users-table-container">
            <table class="users-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Role</th>
                        <th>User Tag</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Last Login</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each users}}
                    <tr data-user-id="{{_id}}">
                        <td>
                            <div class="user-cell">
                                <img src="{{profilePic}}" alt="{{username}}" class="user-avatar">
                                <strong>{{username}}</strong>
                            </div>
                        </td>
                        <td>
                            <span class="role-badge role-{{role}}">{{role}}</span>
                        </td>
                        <td>{{userTag}}</td>
                        <td>
                            {{#if isRestricted}}
                                <span class="status-badge status-restricted">
                                    <i class="fas fa-ban"></i> Restricted
                                </span>
                            {{else}}
                                <span class="status-badge status-active">
                                    <i class="fas fa-check-circle"></i> Active
                                </span>
                            {{/if}}
                        </td>
                        <td>{{formatDate createdAt}}</td>
                        <td>{{formatDate lastLogin}}</td>
                        <td>
                            <div class="action-buttons">
                                {{#if isRestricted}}
                                    <button class="btn-small btn-success" onclick="unbanUser('{{_id}}', '{{username}}')">
                                        <i class="fas fa-unlock"></i> Unban
                                    </button>
                                {{else}}
                                    <button class="btn-small btn-warning" onclick="banUser('{{_id}}', '{{username}}')">
                                        <i class="fas fa-ban"></i> Ban
                                    </button>
                                {{/if}}
                                
                                <button class="btn-small btn-info" onclick="changeRole('{{_id}}', '{{username}}', '{{role}}')">
                                    <i class="fas fa-user-tag"></i> Change Role
                                </button>
                                
                                {{#unless (eq role 'administrator')}}
                                    <button class="btn-small btn-danger" onclick="deleteUser('{{_id}}', '{{username}}')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                {{/unless}}
                            </div>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Create Manager Modal -->
    <div id="createManagerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Create Manager Account</h2>
                <span class="close" onclick="closeCreateManagerModal()">&times;</span>
            </div>
            <form id="createManagerForm" onsubmit="createManager(event)">
                <div class="form-group">
                    <label for="managerUsername">
                        <i class="fas fa-user"></i> Username
                    </label>
                    <input type="text" id="managerUsername" required 
                           placeholder="Enter username" 
                           pattern="[a-zA-Z0-9_]{3,20}"
                           title="3-20 characters, letters, numbers, and underscores only">
                </div>
                
                <div class="form-group">
                    <label for="managerPassword">
                        <i class="fas fa-lock"></i> Password
                    </label>
                    <input type="password" id="managerPassword" required 
                           placeholder="Enter password"
                           minlength="8">
                    <small>Must be at least 8 characters with uppercase, lowercase, number, and special character</small>
                </div>
                
                <div class="form-group">
                    <label for="managerUserTag">
                        <i class="fas fa-tag"></i> User Tag
                    </label>
                    <input type="text" id="managerUserTag" required 
                           placeholder="u/username">
                </div>
                
                <div class="form-group">
                    <label for="managedTags">
                        <i class="fas fa-tags"></i> Managed Tags (comma-separated)
                    </label>
                    <input type="text" id="managedTags" 
                           placeholder="e.g., Food, Travel, Gaming">
                    <small>Optional: Tags this manager can moderate</small>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">
                    <i class="fas fa-user-plus"></i> Create Manager
                </button>
            </form>
        </div>
    </div>

    <script src="/admin-users.js"></script>
</body>
</html>
