<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTalk - CCAPDEV</title>
    <link rel="stylesheet" href="/styles/PageTemplate.css">
    <link rel="stylesheet" href="/styles/Home.css">
    
    <script src="https://kit.fontawesome.com/2616052655.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <div class="logo">
            <img src="/styles/images/logo.jpg" alt="Logo">
        </div>
        <div class="search-bar">
            <input type="text" placeholder="Search..." id="search-input">
            <button id="search-btn">Search</button>
        </div>
        <div class="icons">
            {{#if currentUser}}
                <button class="icon-btn" id="create-post-btn" title="Create Post">
                    <i class="fa-solid fa-plus fa-2x"></i>
                </button>
                <button class="icon-btn" id="profile-btn" title="Profile">
                    <i class="fa-solid fa-user fa-2x"></i>
                </button>
                
                <!-- ADMIN ICON - Only visible to administrators -->
                {{#if (eq currentUser.role 'administrator')}}
                    <a href="/admin" class="icon-btn" title="Admin Dashboard" style="text-decoration: none;">
                        <i class="fa-solid fa-shield-halved fa-2x" style="color: #dc3545;"></i>
                    </a>
                {{/if}}
                
                <!-- MANAGER ICON - Only visible to managers -->
                {{#if (eq currentUser.role 'manager')}}
                    <a href="/manager" class="icon-btn" title="Manager Dashboard" style="text-decoration: none;">
                        <i class="fa-solid fa-user-shield fa-2x" style="color: #ffc107;"></i>
                    </a>
                {{/if}}
                
                <button class="icon-btn" id="menu-btn" title="Menu">
                    <i class="fa-solid fa-bars fa-2x"></i>
                </button>
            {{else}}
                <a href="/login" class="icon-btn" style="text-decoration: none;" title="Login">
                    <i class="fa-solid fa-right-to-bracket fa-2x"></i>
                </a>
            {{/if}}
        </div>
        
        {{#if currentUser}}
        <div id="menu-dropdown" class="menu-dropdown" style="display: none;">
            <ul>
                <li style="padding: 15px; border-bottom: 2px solid #667eea;">
                    <strong style="font-size: 16px;">{{currentUser.username}}</strong><br>
                    <span style="color: #ffc107; font-size: 12px; text-transform: uppercase; font-weight: bold;">
                        {{#if (eq currentUser.role 'administrator')}}
                            üëë ADMINISTRATOR
                        {{else if (eq currentUser.role 'manager')}}
                            üõ°Ô∏è MANAGER/MODERATOR
                        {{else}}
                            üë§ USER
                        {{/if}}
                    </span>
                </li>
                <li style="border-top: 1px solid #333; margin-top: 5px; padding-top: 10px;">
                    <a href="/profile"><i class="fa-solid fa-user"></i> My Profile</a>
                </li>
                
                {{#if (eq currentUser.role 'administrator')}}
                    <li style="background: rgba(220, 53, 69, 0.1);">
                        <a href="/admin" style="color: #dc3545; font-weight: bold;">
                            <i class="fa-solid fa-shield-halved"></i> Admin Dashboard
                        </a>
                    </li>
                    <li><a href="/admin/users"><i class="fa-solid fa-users"></i> Manage Users</a></li>
                    <li><a href="/admin/logs"><i class="fa-solid fa-list"></i> Audit Logs</a></li>
                {{/if}}
                
                {{#if (eq currentUser.role 'manager')}}
                    <li style="background: rgba(255, 193, 7, 0.1);">
                        <a href="/manager" style="color: #ffc107; font-weight: bold;">
                            <i class="fa-solid fa-user-shield"></i> Manager Dashboard
                        </a>
                    </li>
                {{/if}}
                
                <li><a href="/settings"><i class="fa-solid fa-gear"></i> Settings</a></li>
                <li><a href="/change-password"><i class="fa-solid fa-key"></i> Change Password</a></li>
                <li><a href="/about"><i class="fa-solid fa-info-circle"></i> About</a></li>
                <li style="border-top: 1px solid #333; margin-top: 10px; padding-top: 10px;">
                    <a href="/logout" style="color: #dc3545;">
                        <i class="fa-solid fa-right-from-bracket"></i> Log Out
                    </a>
                </li>
            </ul>
        </div>
        {{/if}}
    </header>

    <nav>
        <ul>
            <li><a href="{{#if currentUser}}/home{{else}}/{{/if}}">Home</a></li>
            {{#unless currentUser}}
                <li><a href="/login">Login</a></li>
                <li><a href="/register">Register</a></li>
            {{/unless}}
            <li><a href="/about">About</a></li>
        </ul>
    </nav>
    
    <main>
        {{{body}}}
    </main>

    <footer>
        <p>&copy; 2025 TikTalk Archers</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("DOM Loaded, initializing menu...");
            
            // Menu dropdown
            const menuBtn = document.getElementById("menu-btn");
            const menuDropdown = document.getElementById("menu-dropdown");

            console.log("Menu Button:", menuBtn);
            console.log("Menu Dropdown:", menuDropdown);

            if (menuBtn && menuDropdown) {
                menuBtn.addEventListener("click", function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    console.log("Menu button clicked!");
                    console.log("Current display:", menuDropdown.style.display);
                    
                    if (menuDropdown.style.display === "none" || menuDropdown.style.display === "") {
                        menuDropdown.style.display = "block";
                        console.log("Menu opened");
                    } else {
                        menuDropdown.style.display = "none";
                        console.log("Menu closed");
                    }
                });

                // Close menu when clicking outside
                document.addEventListener("click", function (event) {
                    if (!menuDropdown.contains(event.target) && event.target !== menuBtn && !menuBtn.contains(event.target)) {
                        menuDropdown.style.display = "none";
                    }
                });
            } else {
                console.error("Menu elements not found!");
            }

            // Profile button
            const profileBtn = document.getElementById("profile-btn");
            if (profileBtn) {
                profileBtn.addEventListener("click", function() {
                    window.location.href = "/profile";
                });
            }

            // Search functionality
            const searchInput = document.querySelector("#search-input");
            const searchButton = document.querySelector("#search-btn");

            if (searchButton && searchInput) {
                searchButton.addEventListener("click", () => {
                    const query = searchInput.value.trim();
                    if (!query) return;
                    window.location.href = `/search?q=${encodeURIComponent(query)}`;
                });

                searchInput.addEventListener("keypress", (e) => {
                    if (e.key === "Enter") {
                        const query = searchInput.value.trim();
                        if (!query) return;
                        window.location.href = `/search?q=${encodeURIComponent(query)}`;
                    }
                });
            }
        });
    </script>
</body>
</html>